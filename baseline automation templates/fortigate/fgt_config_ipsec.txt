config vpn ipsec phase1-interface
edit ipsec_tun_${tun_num}
set interface ${svc_int}
set ike-version 2
set keylife 28800
set peertype any
set net-device enable
set proposal aes256-sha384
set dhgrp 19
set nattraversal enable
set remote-gw ${ipsec_peer_addr}
set psksecret ${ipsec_unencrypt_key}
set dpd-retryinterval 10
next
end
config vpn ipsec phase2-interface
edit ipsec_tun_${tun_num}
set phase1name ipsec_tun_${tun_num}
set proposal aes256-sha384 aes256-sha256
set dhgrp 19
set auto-negotiate enable
set keylifeseconds 3600
next
end
config system settings
set gui-multiple-interface-policy enable
end
config system interface
edit ipsec_tun_${tun_num}
set ip ${tun_addr} 255.255.255.255
set allowaccess ping
set type tunnel
set remote-ip ${tun_peer}/${tun_mask}
set interface ${svc_int}
next
end
config firewall policy
edit 0
set name ipsec_tun_${tun_num}
set srcintf ${svc_int} ipsec_tun_${tun_num}
set dstintf ${svc_int} ipsec_tun_${tun_num}
set action accept
set srcaddr all
set dstaddr all
set schedule "always"
set service PING
next
end
config router static
edit 0
set dst ${ipsec_peer_addr}/32
set gateway ${svc_gw_addr}
set device ${svc_int}
next
end