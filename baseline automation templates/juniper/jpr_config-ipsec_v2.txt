-- inputs --
tun_name == tunnel standard name
tun_num == tunnel standard name sequence number
pre_shared_key
ipsec_peer_addr
pub_int
pub_addr
pub_gw_addr
tun_addr
tun_mask

-- start config --
edit
set interfaces st0 unit ${tun_num} family inet address ${tun_addr}/${tun_mask}
set security ike proposal ${tun_name} authentication-method pre-shared-keys
set security ike proposal ${tun_name} authentication-algorithm sha-384
set security ike proposal ${tun_name} encryption-algorithm aes-256-cbc
set security ike proposal ${tun_name} dh-group group19
set security ike proposal ${tun_name} lifetime-seconds 28800
set security ike policy ${tun_name} mode main
set security ike policy ${tun_name} proposals ${tun_name}
set security ike policy ${tun_name} pre-shared-key ascii-text ${pre_shared_key}
set security ike policy ${tun_name} reauth-frequency 0
set security ike gateway ${tun_name} ike-policy ${tun_name}
set security ike gateway ${tun_name} address ${ipsec_peer_addr}
set security ike gateway ${tun_name} external-interface ${pub_int}
set security ike gateway ${tun_name} no-nat-traversal
set security ike gateway ${tun_name} local-identity inet ${pub_addr}
set security ike gateway ${tun_name} version v2-onlyset
set security ike gateway ${tun_name} general-ikeid
set security ike gateway ${tun_name} fragmentation disable
set security ike gateway ${tun_name} dead-peer-detection optimized
set security ike gateway ${tun_name} dead-peer-detection interval 10
set security ike gateway ${tun_name} dead-peer-detection threshold 3
set security ipsec proposal ${tun_name} protocol esp
set security ipsec proposal ${tun_name} authentication-algorithm hmac-sha-256-128
set security ipsec proposal ${tun_name} encryption-algorithm aes-256-cbc
set security ipsec proposal ${tun_name} lifetime-seconds 3600
set security ipsec policy ${tun_name} proposals ${tun_name}
set security ipsec policy ${tun_name} perfect-forward-secrecy keys group19
set security ipsec vpn ${tun_name} bind-interface st0.${tun_num}
set security ipsec vpn ${tun_name} ike gateway ${tun_name}
set security ipsec vpn ${tun_name} ike ipsec-policy ${tun_name}
set security ipsec vpn ${tun_name} ike install-interval 3
set security ipsec vpn ${tun_name} establish-tunnels immediately
set security zones security-zone ${zone} host-inbound-traffic system-services ike
set security zones security-zone ${zone} interfaces st0.${tun_num} host-inbound-traffic system-services ping
set routing-options static route ${ipsec_peer_addr}/32 next-hop ${pub_gw_addr}
commit
